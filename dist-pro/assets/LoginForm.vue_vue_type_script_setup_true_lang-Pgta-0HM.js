var h=(c,y,l)=>new Promise((P,p)=>{var t=n=>{try{d(l.next(n))}catch(u){p(u)}},r=n=>{try{d(l.throw(n))}catch(u){p(u)}},d=n=>n.done?P(n.value):Promise.resolve(n.value).then(t,r);d((l=l.apply(c,y)).next())});import{F as T}from"./Form-bS8bkTLO.js";import{u as W,k as $,d as G,e as D,I as w,A as F,c as H}from"./index-_6ODb6pb.js";/* empty css                    *//* empty css                */import{u as K}from"./useForm-cxQHj52e.js";import{l as Q,aB as X,J as Y,O as o,P as A,r as C,b as Z,w as ee,u as v,m as oe,W as se,y as te}from"./vue-chunks-lfjuOEhN.js";import{u as re}from"./useValidator-gozR_cIE.js";import{m as ne,D as ae}from"./element-plus-jCRIyYSE.js";function S(c){return typeof c=="function"||Object.prototype.toString.call(c)==="[object Object]"&&!te(c)}const b=30,R="#999",I="var(--el-color-primary)",he=Q({__name:"LoginForm",emits:["to-register"],setup(c,{emit:y}){const{required:l}=re(),P=y,p=W(),t=$(),r=G(),{currentRoute:d,addRoute:n,push:u}=X(),{t:a}=H(),L={username:[l()],password:[l()]},E=Y([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>o("h2",{class:"text-2xl font-bold text-center w-[100%]"},[a("login.login")])}}},{field:"username",label:a("login.username"),component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:a("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test"}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return o(A,null,[o("div",{class:"flex justify-between items-center w-[100%]"},[o(ne,{modelValue:f.value,"onUpdate:modelValue":s=>f.value=s,label:a("login.remember"),size:"small"},null),o(ae,{type:"primary",underline:!1},S(e=a("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,s;return o(A,null,[o("div",{class:"w-[100%]"},[o(D,{loading:_.value,type:"primary",class:"w-[100%]",onClick:N},S(e=a("login.login"))?e:{default:()=>[e]})]),o("div",{class:"w-[100%] mt-15px"},[o(D,{class:"w-[100%]",onClick:U},S(s=a("login.register"))?s:{default:()=>[s]})])])}}}},{field:"other",component:"Divider",label:a("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>o(A,null,[o("div",{class:"flex justify-between w-[100%]"},[o(w,{icon:"ant-design:github-filled",size:b,class:"cursor-pointer ant-icon",color:R,hoverColor:I},null),o(w,{icon:"ant-design:wechat-filled",size:b,class:"cursor-pointer ant-icon",color:R,hoverColor:I},null),o(w,{icon:"ant-design:alipay-circle-filled",size:b,color:R,hoverColor:I,class:"cursor-pointer ant-icon"},null),o(w,{icon:"ant-design:weibo-circle-filled",size:b,color:R,hoverColor:I,class:"cursor-pointer ant-icon"},null)])])}}}]),f=C(t.getRememberMe),V=()=>{const e=t.getLoginInfo;if(e){const{username:s,password:i}=e;B({username:s,password:i})}};Z(()=>{V()});const{formRegister:j,formMethods:M}=K(),{getFormData:z,getElFormExpose:q,setValues:B}=M,_=C(!1),k=C("");ee(()=>d.value,e=>{var s;k.value=(s=e==null?void 0:e.query)==null?void 0:s.redirect},{immediate:!0});const N=()=>h(this,null,function*(){const e=yield q();yield e==null?void 0:e.validate(s=>h(this,null,function*(){if(s){_.value=!0;const i=yield z();try{const m=yield F.login.loginApi(i);if(m){v(f)?t.setLoginInfo({username:i.username,password:i.password}):t.setLoginInfo(void 0),t.setRememberMe(v(f)),t.setUserInfo(i);const{access_token:g,expires_in:x}=m.result;t.setToken(g,x),p.getDynamicRouter?O():(yield r.generateRoutes("static").catch(()=>{}),r.getAddRouters.forEach(J=>{n(J)}),r.setIsAddRouters(!0),u({path:k.value||r.addRouters[0].path}))}}finally{_.value=!1}}}))}),O=()=>h(this,null,function*(){var g;const s={roleName:(yield z()).username},m=((g=(yield F.login.getAdminRoleApi(s)).result)==null?void 0:g.routers)||[];t.setRoleRouters(m),r.generateRoutes("server",m),r.getAddRouters.forEach(x=>{n(x)}),r.setIsAddRouters(!0),u({path:k.value||r.addRouters[0].path})}),U=()=>{P("to-register")};return(e,s)=>(oe(),se(v(T),{schema:E,rules:L,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:v(j)},null,8,["schema","onRegister"]))}});export{he as _};
