var f=(r,c,t)=>new Promise((p,o)=>{var i=l=>{try{a(t.next(l))}catch(n){o(n)}},u=l=>{try{a(t.throw(l))}catch(n){o(n)}},a=l=>l.done?p(l.value):Promise.resolve(l.value).then(i,u);a((t=t.apply(r,c)).next())});import{F as _}from"./Form-bS8bkTLO.js";import{u as w}from"./useForm-cxQHj52e.js";import{c as C,A as k}from"./index-_6ODb6pb.js";import{u as j}from"./useValidator-gozR_cIE.js";import{b as v,d as A}from"./element-plus-jCRIyYSE.js";import{l as E,r as F,e as x,J as h,O as d,P as R,w as U,m as B,W as M,u as g,y as O}from"./vue-chunks-lfjuOEhN.js";function V(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!O(r)}const H=E({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(r,{expose:c}){const{required:t}=j(),p=r,{t:o}=C(),{formRegister:i,formMethods:u}=w(),{setValues:a,getFormData:l,getElFormExpose:n,setSchema:P}=u,s=F(""),D=x(()=>s),y=h([{field:"title",label:o("exampleDemo.title"),component:"Input",formItemProps:{rules:[t()]},colProps:{span:12}},{field:"categories",label:o("exampleDemo.category"),component:"Category",componentProps:{onCheckChange:e=>{a({categories:e})},checkedCategories:x(()=>{var e;return((e=p.currentRow)==null?void 0:e.categories)||[]}),showCheckbox:!0},formItemProps:{},colProps:{span:12}},{field:"tags",label:o("exampleDemo.tags"),component:"Tags",componentProps:{style:"color=red",onTagsChange:e=>{a({tags:e})}},colProps:{span:12}},{field:"description",label:o("exampleDemo.subtitle"),component:"Input",formItemProps:{rules:[t()]},colProps:{span:12}},{field:"thumbnail",component:"Input",hidden:!1,value:D},{field:"thumbnailUpload",label:o("exampleDemo.thumbnail"),component:"Upload",componentProps:{httpRequest:e=>f(this,null,function*(){const m=yield k.Common.postStaticApi({file:e.file,name:"thumbnail/"+e.file.name});s.value=m.url}),showFileList:!1,beforeUpload:e=>e.type!=="image/jpeg"?(v.error("Avatar picture must be JPG format!"),!1):e.size/1024/1024>2?(v.error("Avatar picture size can not exceed 2MB!"),!1):!0,slots:{default:()=>{let e;return d(R,null,[s.value?d("img",{src:s.value,class:"avatar"},null):null,s.value?null:d(A,{type:"primary"},V(e=o("exampleDemo.addThumbnail"))?e:{default:()=>[e]})])}}},colProps:{span:24}},{field:"author",label:o("exampleDemo.author"),component:"Input"},{field:"state",label:o("exampleDemo.state"),component:"Select",formItemProps:{rules:[t()]},componentProps:{options:[{label:o("exampleDemo.state1"),value:0},{label:o("exampleDemo.state2"),value:1},{label:o("exampleDemo.state3"),value:-1}]},value:1},{field:"public",label:o("exampleDemo.public"),component:"Select",formItemProps:{rules:[t()]},componentProps:{options:[{label:o("exampleDemo.public1"),value:1},{label:o("exampleDemo.public2"),value:-1},{label:o("exampleDemo.public3"),value:0}]},value:1},{field:"featured",label:o("exampleDemo.featured"),component:"Switch",value:!1},{field:"origin",label:o("exampleDemo.articleSource"),component:"Select",formItemProps:{rules:[t()]},componentProps:{options:[{label:o("exampleDemo.articleSource1"),value:0},{label:o("exampleDemo.articleSource2"),value:1},{label:o("exampleDemo.articleSource3"),value:2}]},value:0},{field:"importance",label:o("exampleDemo.importance"),component:"Select",formItemProps:{rules:[t()]},componentProps:{options:[{label:"重要",value:3},{label:"良好",value:2},{label:"一般",value:1}]},value:1},{field:"content",component:"MarkdownEditor",colProps:{span:24},componentProps:{text:"",change:(e,m)=>{a({content:m})}},label:o("exampleDemo.description")}]),I=h({title:[t()],description:[t()],thumbnail:[t()],importance:[t()],display_time:[t()],content:[t()]}),S=()=>f(this,null,function*(){const e=yield n();if(yield e==null?void 0:e.validate().catch(b=>{}))return yield l()});return U(()=>p.currentRow,e=>{e&&(a(e),P([{field:"content",path:"componentProps.defaultHtml",value:e.content}]))},{deep:!0,immediate:!0}),c({submit:S}),(e,m)=>(B(),M(g(_),{rules:I,onRegister:g(i),schema:y,labelPosition:"top"},null,8,["rules","onRegister","schema"]))}});export{H as _};
